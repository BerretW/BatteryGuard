version: '3.8'

services:
  # 1. Databáze
  mongo:
    image: mongo:6.0
    container_name: batteryguard-mongo
    restart: unless-stopped
    volumes:
      - mongo_data:/data/db
    networks:
      - bg-network

  # 2. Backend
  backend:
    build: ./backend
    container_name: batteryguard-backend
    restart: unless-stopped
    environment:
      - MONGO_URL=mongodb://mongo:27017
      
      - SECRET_KEY=${SECRET_KEY:-vas_tajny_klic_pro_jwt_tokeny_zmente_v_produkci}
      - ADMIN_EMAIL=${ADMIN_EMAIL:-admin@appartus.cz}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-zmente_tohle_heslo}
      - ALLOWED_ORIGINS=http://battery.appartus.cz,https://battery.appartus.cz,http://localhost,http://localhost:3000,http://prox2.appartus.cz
      # GOOGLE CONFIG PRO BACKEND (pro ověření tokenu)
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:-vase_google_client_id.apps.googleusercontent.com}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET} # (není povinné, ale doporučené)
    depends_on:
      - mongo
    networks:
      - bg-network

  # 3. Frontend
  frontend:
    build: 
      context: ./frontend
      # Předání proměnných při buildu (Vite potřebuje ENV při buildu)
      args:
        - VITE_API_BASE_URL=/api
        - VITE_GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:-vase_google_client_id.apps.googleusercontent.com}
    container_name: batteryguard-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - bg-network

volumes:
  mongo_data:

networks:
  bg-network:
    driver: bridge